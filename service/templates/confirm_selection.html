{% extends "layout.html" %}

{% block body %}

<div style="width:66%;float:left;">
    <!-- 1. Start Title information (number, address and tenure information) -->
    <h1 class="heading-large collapse-top">Confirm your order</h1>
    <p class="">You’ll get a summary of the information Land Registry holds for this property title:</p>
    <dl class="definition-tabular expand-top-half">
      {% if params['title'] and params['title'].get('is_caution_title') %}
        <dt class="bold-small">Caution</dt>
        <dd>
          <details class="font-xsmall">
            <summary class="bold-small">Caution against first registration</summary>
            <div class="panel" style="margin-bottom:2em;">
              <p>This property hasn’t been registered yet. You can’t find out who owns it from this service.</p>
              <p>Someone other than the owner (known as the ‘cautioner’) has registered a right or interest in the property. They will be told if anyone tries to register it, and can object to the registration going ahead until their claim has been looked at. You can get their name and address from this service.</p>
              <p>Registration has only been compulsory since the 1990s. Property that hasn’t changed hands since then may not be registered.</p>
            </div>
          </details>
        </dd>
        </dt>
      {% endif %}
      <dt>Address</dt>
      <dd><span class="heading-small">
        {% if params['title']['address_lines'] %}
        {{ '<br>'.join(params['title']['address_lines'])|safe }}
        {% else %}
        {{ _('Not Available') }}
        {% endif %}
      </span></dd>
      <dt>Title number</dt>
      <dd class="bold-small">{{ params['title_number'] }}</dd>
      <dt>Tenure type</dt>
      <dd>
        <details class="font-xsmall">
          <summary class="bold-small">{{ params['title']['tenure'] }}</summary>
          <div class="panel" style="margin-bottom:2em;">

          {% if params['title']['tenure'].upper() == 'LEASEHOLD' %}
            <p>You only own a leasehold property for a fixed period of time. You'll have a legal agreement the landlord (sometimes known as the ‘freeholder’) called a ‘lease’. This tells you how many years you’ll own the property.</p>
            <p>Most flats are leasehold. Houses can be leasehold too and usually are if they’re bought through a shared ownership scheme.</p>
            <p>The leasehold and freehold are registered separately with the Land Registry. Each has its own title documents. <b class="bold-xsmall">You are buying a summary of the leasehold owner, not the freehold.</b></p>

            <a rel="external" href="https://www.gov.uk/leasehold-property/overview">More about Leasehold on GOV.UK</a>

          {% elif params['title']['tenure'].upper() == 'FREEHOLD' %}
            <p>You own a freehold building and land outright. It is yours until you sell it or give it away.</p>
            <p>Most houses are freehold. Most flats are leasehold. That means someone else owns the freehold for the building the flat is in. <b class="bold-xsmall">If you want to know who owns a particular flat, you probably need the leasehold.</b></p>
            <p>Houses can also be leasehold and usually are if they’re bought through a shared ownership scheme.</p>

          {% endif %}
          </div>
        </details>
        <p class="font-xsmall">A property can have both a freehold and a leasehold title. To get a different tenure for this address, <a href="{{ url_for('find_titles_page', search_term=params['search_term'], page=params['display_page_number']) }}">go back</a> and select the one you need.</p>
      </dd>
    </dl>

    <h2 class="heading-medium collapse-top">The summary will tell you</h2>
    <ul class="list-bullet">
      {% if params['title']['tenure'].upper() == 'FREEHOLD' %}
        <li>current owner’s name and address</li>
      {% elif params['title']['tenure'].upper() == 'LEASEHOLD' %}
        <li>current leaseholder’s name and address</li>
      {% endif %}
      <li>what they paid for the property – you won’t get this if it was bought before April 2000, if no money changed hands, or if the owner didn’t buy it outright</li>
      <li>if there is a mortgage on the property, the lender’s name and  address</li>
    </ul>
    <!-- <p>You'll need to <a target="_blank" href="https://www.gov.uk/get-information-about-property-and-land">use a different Land Registry service</a> if you need more detailed information or to prove ownership in court.</p> -->
    <div class="notice" style="background-color:#fff2d3;padding: 25px">
      <img src="/static/govuk_frontend_toolkit/images/icon-important.png" alt="" style="float: left;margin-right: 15px;" />
      <p style="overflow:hidden;margin:0;"><strong class="bold-small">You'll only be able to view the information once</strong><br>
        If you want to keep a copy you can print it out</p>
    </div>

      <h2 class="heading-medium">The summary costs {{ price_text | safe }}</h2>
      <p>You can pay by credit or debit card.</p>
      <p>You need to accept the following terms to continue.</p>
      <div class="form-group expand-bottom-half" id="right_to_cancel_group">
        <label class="block-label" for="right_to_cancel">
        <input id="right_to_cancel" name="right_to_cancel" type="checkbox" value="right_to_cancel">
        I agree that you will provide the summary as soon as I’ve paid.<br>
        I accept that I will lose my right to cancel the contract once the summary is displayed.
        </label>
      </div>

    <form class="form" action="{{ action_url }}" method="post">
      <input type='hidden' name='MC_titleNumber' id='MC_titleNumber' value="{{params.MC_titleNumber}}"/>
      <input type='hidden' name='MC_searchType' id='MC_searchType' value="{{params.MC_searchType}}"/>
      <input type='hidden' name='MC_timestamp' id='MC_timestamp' value="{{params.MC_timestamp}}"/>
      <input type='hidden' name='MC_purchaseType' id='MC_purchaseType' value="{{params.MC_purchaseType}}"/>
      <input type='hidden' name='MC_unitCount' id='MC_unitCount' value="{{params.MC_unitCount}}"/>
      <input type='hidden' name='MC_userId' id='MC_userId' value="{{params.MC_userId}}"/>
      <input type='hidden' name='cartId' id='cartId' value="{{params.cartId}}"/>
      <input type='hidden' name='amount' id='amount' value="{{params.amount}}"/>
      <button type="submit" class="button" onclick="return checkRightToCancel()">Buy title summary</button>
    </form>
</div>

<div style="width:30%;float:right;">
  <div id="map" style="height: 0 !important; padding-bottom: 100% !important; width: 100% !important;">
    <div class="panel-simple">
      <p>The map relies on JavaScript being enabled in your browser.</p>
    </div>
  </div>
  <!-- <p class="font-xsmall">This map shows the property's rough extent and location, not legal boundaries.</p> -->
</div>

<br/>

<!-- Offer user a link back to the Search Results -->
<div style="clear:both;">
  <a href="{{ url_for('find_titles_page', search_term=params['search_term'], page=params['display_page_number']) }}">Back to search results</a>
</div>

<script type='text/javascript'>

var indexData = {{ params['title']['indexPolygon'] | tojson }};

var msg = document.createElement('span');
msg.classList.add('error-message');
msg.textContent = 'You need to agree to receive the summary straight away and that you’ll lose your right to cancel';
var rightToCancelGroup = document.getElementById('right_to_cancel_group');
function checkRightToCancel() {
  if(msg.parentNode) {
    msg.parentNode.removeChild(msg);
    rightToCancelGroup.classList.remove('error');
  }
  if(!document.getElementById('right_to_cancel').checked) {
    rightToCancelGroup.classList.add('error');
    rightToCancelGroup.appendChild(msg);
    return false;
  }
}
</script>

<script src="/static/javascripts/map.js"></script>
<link rel="stylesheet" href="/static/vendor/leaflet-0.7.3/leaflet.css" />
<script src="/static/vendor/leaflet-0.7.3/leaflet.js"></script><!-- Leaflet -->
<script src="/static/javascripts/proj4.js"></script><!-- proj4js -->
<script src="/static/javascripts/proj4leaflet.js"></script><!-- proj4leaflet -->

{% endblock %}
