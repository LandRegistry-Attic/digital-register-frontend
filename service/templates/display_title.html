{% extends "imports.html" %}
{% block head_additionals %}
<style>
  #map{
    height:320px !important;
    width:320px !important;
  }
  .btn-href {
    background: none;
    border: 0;
    font-size: 0.9em;
    cursor: pointer;
    text-decoration: underline;
    padding-left:0;
  }

  .lang-form label {
    font-size: 0.9em;
  }
</style>
{% endblock %}

{% block welsh_language_toggle %}
<div class="language">
          {# The following form resubmits the page if an alternate (english or welsh) #}
          {# language is selected. The language code goes in g.locale. The form has #}
          {# no action specified in order to resubmit the current page while maintaining #}
          {# the query string. The route is a GET so the method is get, with 'language=' #}
          {# added to the query string (ie, not POST + http header variables) #}

          <form method="GET" class='lang-form'>
            {% if g.locale == 'en' %}
              <input type='hidden' name='language' value='cy'/>
              <label for='submit-btn'>English</label>|<input id='submit-btn' type='submit' class='btn-href' value='Cymraeg' />
            {% else %}
              <input type='hidden' name='language' value='en'/>
              <input id='submit-btn' type='submit' class='btn-href' value='English' />|<label for='submit-btn'>Cymraeg</label>
            {% endif %}
          </form>
        </div>
{% endblock %}

{% block body %}

{# Slightly convoluted heading to cater for variations in Welsh #}
<h1 class="heading-large">
{% if is_caution_title %}
{{ _('Summary of caution title') }}
{% else %}
{{ _('Summary of title') }}
{% endif %}
 {{ title.number }}
</h1>

<p class="font-xsmall">{{ _('This title was last changed on') }} {{ title.last_changed | date }} {{ _('at') }} {{ title.last_changed | time }}</p>

<div class="grid-row">
  <div class="column-two-thirds">
    <hr class="collapse-top">
    <dl class="definition-tabular expand-top-half">
        {% if is_caution_title %}
          <dt class="bold-small">Caution</dt>
          <dd>
            <details class="font-xsmall">
              <summary class="bold-small">Caution against first registration</summary>
              <div class="panel" style="margin-bottom:2em;">
                <p>This property hasn’t been registered yet. You can’t find out who owns it from this service. </p>
                <p>Someone other than the owner (known as the ‘cautioner’) has registered a right or interest in the property. They will be told if anyone tries to register it, and can object to the registration going ahead until their claim has been looked at. You can get the cautioner’s name and address from this service.</p>
                <p>Registration has only been compulsory throughout England and Wales since the 1990s. Property that hasn’t changed hands since then may not be registered.</p>
              </div>
            </details>
          </dd>
          </dt>
        {% endif %}
    <dt>Address</dt>
    <dd><span class="heading-medium">
            {% if title.address_lines %}
              {{ '<br>'.join(title.address_lines)|safe }}
            {% else %}
              {{ _('Not Available') }}
            {% endif %}
        </span>
    </dd>
      <dt>{% if is_caution_title %}{{ _('Cautioner') }}{% else %}{{ _('Owner') }}{% endif %}{{ title.proprietors|length|pluralize }}</dt>
      <dd>
        {% for proprietor in title.proprietors %}
          <h5 class="{% if loop.index != 1 %} expand-top-half {% endif %}">
            <span class="heading-small">{{ proprietor.name }}</span>{{ proprietor.name_extra_info }}
          </h5>
          {% if proprietor.co_reg_no %}
            <div>{{ proprietor.co_reg_no }}</div>
              {% if proprietor.company_location %}
                <div>{{ proprietor.company_location }}</div>
              {% endif %}
          {% endif %}
          {% for address in proprietor.addresses %}
            <div>{{ '<br>'.join(address.lines)|safe }}</div>
          {% endfor %}
        {% endfor %}
      </dd>
        {% if title.lenders %}
          <dt>{{ _('Lender') }}{{ title.lenders|length|pluralize }}</dt>
          <dd>
            {% for lender in title.lenders %}
              <h5 class="{% if loop.index != 1 %} expand-top-half {% endif %}">
                <span class="heading-small">{{ lender.name }}</span>{{ lender.name_extra_info }}
              </h5>
              {% if lender.co_reg_no %}
                <div>{{ lender.co_reg_no }}</div>
              {% endif %}
              {% if lender.company_location %}
                <div>{{ lender.company_location }}</div>
              {% endif %}
              {% for address in lender.addresses %}
                <div>{{ '<br>'.join(address.lines)|safe }}</div>
              {% endfor %}
            {% endfor %}
          </dd>
        {% endif %}

        {% if title.tenure %}
          <dt>{{ _('Tenure type') }}</dt>
          <dd><b>{{ title.tenure }}</b></dd>
        {% endif %}

        {% if title.ppi_data %}
          <dt>{{ _('Price paid/stated') }}</dt>
          <dd><b>{{ title.ppi_data }}</b></dd>
        {% endif %}
      </dl>

      <div>
        <p>
          This information can change if we receive an application. This service is unable to tell you whether or not there is an application pending with the Land Registry.
        </p>
      </div>
      <div class="govuk-box-highlight">
        <p><b>{{ _('You\'ll only be able to view this information once') }}</b><br>
            {{ _('If you want to keep a copy you can print it out') }}</p>

        <a class="button-print" href="javascript:window.print();">{{ _('Print this page') }}</a>

      </div>

      <div class="printhidden">
        <h2><strong>What did you think of this service?</strong></h2>
        <p>
          <a href="#" rel="external">Please give us your feedback</a> (takes 30 seconds).<br>
          This is a new service and your feedback will help us improve it.
        </p>
      </div>

      <hr>
      {% if receipt %}
        <h2 class="heading-medium">VAT receipt</h2>
        <div class="grid-row">
          <div class="column-two-thirds">
            <dl class="definition-tabular-1-3">
            {% if receipt.date %}
              <dt class="bold-xsmall">Date</dt>
              <dd class="font-xsmall">{{ receipt.date }}</dd>
            {% endif %}

            {% if receipt.trans_id %}
              <dt class="bold-xsmall">Transaction ID / Invoice number</dt>
              <dd class="font-xsmall expand-bottom-half">{{ receipt.trans_id }}</dd>
            {% endif %}

            {% if receipt.title_number %}
              <dt class="bold-xsmall">Description of the goods or services</dt>
              <dd class="font-xsmall expand-bottom-half">Summary of title: {{ receipt.title_number }}</dd>
            {% endif %}

            {% if receipt.net %}
              <dt class="bold-xsmall">Net value</dt>
              <dd class="font-xsmall">&pound{{ receipt.net }}</dd>
            {% endif %}

            {% if receipt.vat %}
              <dt class="bold-xsmall">VAT charged (20%)</dt>
              <dd class="font-xsmall">&pound{{ receipt.vat }}</dd>
            {% endif %}

            {% if receipt.total %}
              <dt class="bold-xsmall">Total inc. VAT</dt>
              <dd class="font-xsmall">&pound{{ receipt.total }}</dd>
            {% endif %}
            </dl>
          </div>
          <div class="column-one-third">
            {% if receipt.address1 %}
            <p>
                <strong>{{ receipt.address1 }}</strong><br>
                {{ receipt.address2 }}<br>
                {{ receipt.address3 }}<br>
                {{ receipt.address4 }}<br>
                {{ receipt.postcode }}<br>
            </p>
            {% endif %}

            {% if receipt.reg_number %}
            <p>
              <strong>VAT registration number</strong><br>
              {{ receipt.reg_number }}
            </p>
            {% endif %}
          </div>
        </div>
    <hr>
      {% endif %}

      {% if show_pdf %}
        <div class="download-documents js-stick-at-top-when-scrolling">
          <div class="document-item">
            <a href="{{ url_for('display_title_pdf', title_number=title.number) }}" class="image">
              <img src="/static/images/icon-register-document.png">
            </a>
            <span class="title">{% if is_caution_title %}Caution title register{% else %}Title register{% endif %}</span><br>
            <span class="footnote">{% if is_caution_title %}Caution title {% endif %}PDF document</span>
            <p>
              <a class="button" id="download-link" style="vertical-align: baseline;" href="{{ url_for('display_title_pdf', title_number=title.number) }}" target="_blank"><b>Download</b></a>
            </p>
          </div>
        </div>
      {% endif %}

    </div>

  <div class="column-third">
    <div id="map" class="polygon" style="height: 0 !important; padding-bottom: 100% !important;width: 100% !important;">
      <div class="panel-simple">
        <p>{{ _('The map relies on JavaScript being enabled in your browser.') }}</p>
      </div>
    </div>
    <p class="font-xsmall">{{ _('This map shows the property\'s rough extent and location, <b>not legal boundaries.</b>') }}</p>
  </div>

</div>

  {% if full_title_data %}
    <div class="service-notice expand-bottom">
      {% include 'display_full_title_details.html' %}
    </div>
  {% endif %}

<div class="grid-row">
  <div class="text legal-division--top font-xsmall">
    <div class="panel-indent">
      <p>{{ _('If you have any problems with your purchase, you can call Land Registry on') }} <b>0300 006 0411</b>.</p>
      <p>{{ _('For more contact methods, visit ') }}<a href="https://www.gov.uk/government/organisations/land-registry">www.gov.uk/government/organisations/land-registry</a></p>
    </div>
  </div>
  <div class="text printhidden">
    <h6 class="heading-medium">{{ _('What next') }}</h6>
    <ul>
      <li><a href="{{ url_for('find_titles') }}">{{ _('Search for another title using this service') }}</a></li>
      <li><a href="https://gov.uk">{{ _('Return to') }} GOV.UK</a></li>
    </ul>
  </div>
</div>

{% endblock %}

{% block js_bottom %}
<script type='text/javascript'>
  //var indexData = {"crs": {"properties": {"name": "urn:ogc:def:crs:EPSG::27700"}, "type": "name"}, "geometry": {"coordinates": [[[441187.5, 112344.0], [441186.0, 112354.0], [441193.0, 112356.5], [441194.5, 112346.5]]], "type": "Polygon"}, "properties": {"colour": 25, "feature_id": 4019, "graphic_type": "Bordered Polygon", "render_attributes": {"border_colour": 25, "border_width": 0, "exterior_edge_colour": 1, "exterior_edge_thickness": 2, "exterior_edge_thickness_units": "Pixels", "fill_colour": 25, "fill_style": 9, "render_level": "0"}, "width": 0}, "type": "Feature"}
  var indexData = {{ title.indexPolygon | tojson }};
</script>

<script src="/static/javascripts/map.js"></script>
<link rel="stylesheet" href="/static/vendor/leaflet-0.7.3/leaflet.css" />
<link rel="stylesheet" href="/static/stylesheets/application.css" />
<script src="/static/vendor/leaflet-0.7.3/leaflet.js"></script><!-- Leaflet -->
<script src="/static/javascripts/proj4.js"></script><!-- proj4js -->
<script src="/static/javascripts/proj4leaflet.js"></script><!-- proj4leaflet -->

{% endblock %}
