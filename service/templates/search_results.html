{% extends "layout.html" %}

{% block body %}

  {% set display_page_number = results.get('page_number', 0) + 1 %}

  <form class="form" action="{{ url_for('find_titles') }}" method="post" role="form">
    {{ form.hidden_tag() }}
    <div class="form-group">
      <h1 class="heading-medium">
        <label for="search_term">
          Search results for <span class="visuallyhidden">{% if search_term %}{{ search_term }}{% endif %}</span>
        </label>
      </h1>
      <input type="text" class="form-control" name="search_term" id="search_term" value="{% if search_term %}{{ search_term }}{% endif %}"  autofocus="autofocus">
      <input type="submit" value="Search" class="button search-button">
    </div>
  </form>
  <div class="grid-row">
    <div class="column-two-thirds">
      <h2 class="font-xsmall expand-bottom-half">{{ results['number_results'] }} result{{ results['number_results']|pluralize }} found</h2>
      <ol class="search-results-listing">
        {% for title in results['titles'] %}
          <li>
            <h2 class="heading-small">
              {% if title['data'] %}
                <a href="{{ url_for('get_title', title_number=title['title_number'], page=display_page_number, search_term=search_term) }}">{% if addressbase %}{{ title['address'] }}{% else %}{{ title['data']['address']['address_string'] }}{% endif %}</a>
              {% else %}
                {{ title['address'] }}
              {% endif %}
            </h2>
            <div class="font-xsmall">
                {% if title['data'] and title['data'].get('is_caution_title') %}Caution title {% else %}Title {% endif %} number {{ title['title_number'] }}<br>
              <b>{{ title | tenure_info }}</b>
            </div>
          </li>
        {% endfor %}
      </ol>

      {% if results['number_pages'] %}
        <div class="pagination-prev-next">
          {% if display_page_number > 1 or display_page_number < results['number_pages'] %}
            <ul>
              {% if display_page_number > 1 %}
                <li class="previous-page">
                  <a href="{{ url_for('find_titles', search_term=search_term, page=display_page_number - 1) }}">
                    <span class="pagination-label">Previous <span class="visuallyhidden">page</span></span>
                  </a>
                </li>
              {% endif %}
              {% if display_page_number < results['number_pages'] %}
                <li class="next-page">
                  <a href="{{ url_for('find_titles', search_term=search_term, page=display_page_number + 1) }}">
                    <span class="pagination-label">Next <span class="visuallyhidden">page</span></span>
                  </a>
                </li>
              {% endif %}
            </ul>
          {% endif %}
        </div>
        <div id="pagination" style="text-align: center">Page {{ display_page_number }} of {{ results['number_pages'] }}</div>
      {% endif %}
    </div>
    <div class="column-third">
      <h2 style="border-top: 10px solid #005ea5;padding-top:25px;" class="heading-medium">Help finding the right property</h2>
      <p>
        <img style="display: block;margin-bottom:10px" src="/static/images/beta.png" alt="">
        This is a beta service. If you're not seeing the search results you expect please <a rel="external" href="mailto:digital-register-feedback@digital.landregistry.gov.uk">let us know</a>
      </p>
      <p>If you're having trouble finding the property or land you're looking for, try the <a href="https://eservices.landregistry.gov.uk/www/wps/portal/!ut/p/b1/04_SjzS0MDc3NjeyNDDSj9CPykssy0xPLMnMz0vMAfGjzOKNjSxMDA1NjDwsjM3MDTxN3dyNDUNMjQ1MjPWDU_P0c6McFQGRbYf3/">existing Land Registry service</a> instead</p>
    </div>
  </div>
{% endblock %}

{% block js_bottom %}
  <script type="text/javascript">
    number_results = {{ results['titles']|length }};
    page_number = {{ display_page_number or 0 }};
  </script>
  <script src="/static/javascripts/ga_search_results.js"></script>
{% endblock %}
